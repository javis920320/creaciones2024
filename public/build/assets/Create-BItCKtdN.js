import{j as e,r as n,b as y,W as R,a as B,Y as M}from"./app-DNyFTp_I.js";import{A as $}from"./AuthenticatedLayout-BnJvsuQ8.js";import{S as q}from"./SecondaryButton-FB2uHwgr.js";import{I as j}from"./InputLabel-CjOAn4vy.js";import{P as V}from"./PrimaryButton-D06jB3ZH.js";import{T as W}from"./TextInput-XZFMSyYV.js";import{S as w}from"./SelectList-CCFhlCcc.js";import{I as b}from"./InputError-BvMGdLL_.js";import{F as z}from"./index-DezAKa5j.js";import{D as Y}from"./Divider-BSZ8sysL.js";import{q as G}from"./transition-CrWVsblw.js";import{C as D,a as P}from"./CardContent-Dy-w9BFJ.js";import{D as H,a as J,b as K,c as Q}from"./DialogTitle-CLI0o4oj.js";import{B as U}from"./Button-DS6YXrBR.js";import"./ApplicationLogo-BoN71fHg.js";import"./DefaultPropsProvider-C3h8kBm-.js";import"./clsx-B-dksMZM.js";import"./Paper-Cb6JEsLz.js";import"./useForkRef-DD34cN-A.js";import"./useSlotProps-BahrZ6Da.js";const N=({className:t="",...s})=>e.jsx("input",{...s,type:"radio",className:"rounded dark:bg-gray-900 border-gray-300 dark:border-gray-700 text-indigo-600 shadow-sm focus:ring-indigo-500 dark:focus:ring-indigo-600 dark:focus:ring-offset-gray-800 "+t});function X(t=[]){const[s,x]=n.useState(null),[c,a]=n.useState([]),i=async l=>{try{const{data:m}=await y(route("productos.categoria",l));a(m)}catch(m){x(m)}};return n.useEffect(()=>{t&&i(t)},[]),{obtenerProductosconcategoria:i,products:c,errorsProduct:s}}function Z(t){const[s,x]=n.useState([]),[c,a]=n.useState(null),[i,l]=n.useState(!1),[m,h]=n.useState(0),g=p=>{l(!0),y.get(route("asignacion.listar",p)).then(d=>{x(d.data)}).catch(d=>{a(d)}).finally(()=>l(!1))},o=()=>{const p=s.reduce((d,A)=>d+A.cantidad,0);h(p)};return n.useEffect(()=>{s.length>0&&o()},[s]),n.useEffect(()=>{t&&g(t)},[t]),{asignacion:s,errorAsignacion:c,AsignarOrden:p=>{y.post(route("asignacion.store"),p).then(d=>{d.data.errors?a(d.data.errors):g(t)}).catch(d=>{d.response&&d.response.data&&d.response.data.errors?a(d.response.data.errors):a(d.message)})},loading:i,numerodeasignaciones:m,deleteAsignacion:p=>{y.delete(route("asignacion.delete",p)).then(d=>{d.data.eliminado&&g(t)})}}}const ee=({asignacion:t,deleteAsignacion:s})=>{const x=t.length>0,c=a=>{s(a)};return e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Empleado"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Order ID"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Fecha Asignación"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Estado"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Cantidad"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Costo"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Tipo Costo"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:x?t.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b",children:a.empleado.nombreCompleto}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.order_id}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.fecha_asignacion}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.estado}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.cantidad}),e.jsxs("td",{className:"py-2 px-4 border-b",children:["$ ",isNaN(Number(a.costo))?"0.00":Number(a.costo).toFixed(2)]}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.tipocosto}),e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsxs("button",{onClick:()=>c(a.id),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"sr-only",children:"Eliminar"})]})})]},a.id)):e.jsx("h2",{children:"No hay datos"})})]})},se=({empleados:t,orden:s})=>{const{obtenerProductosconcategoria:x,products:c,errorsProduct:a}=X(s.categoriaId),{errorAsignacion:i,asignacion:l,AsignarOrden:m,loading:h,numerodeasignaciones:g,deleteAsignacion:o}=Z(s.id),[v,_]=n.useState(""),[p,d]=n.useState(),{data:A,setData:u,errors:f,setError:E,recentlySuccessful:F,processing:k,clearErrors:I}=R({order_id:(s==null?void 0:s.id)||null,empleado_id:""});n.useEffect(()=>{i?(console.log("cambio de error"),E(typeof i=="object"&&i!==null?i:{general:i})):E(null)},[i]);const L=r=>{const C=r.target.value,T=t.find(S=>S.id==C);d(T.cargo),u(S=>({...S,empleado_id:r.target.value}))},O=r=>{r.preventDefault(),m(A),I()};return e.jsxs("div",{children:[e.jsxs("form",{onSubmit:O,className:"my-2",children:[c.length>0?e.jsxs("div",{children:[e.jsx(j,{children:"Producto"}),e.jsxs(w,{onChange:r=>u("producto",r.target.value),className:"w-1/2",children:[e.jsx("option",{defaultValue:!0,children:"Seleccione "}),c.map(({nameProduct:r,id:C})=>e.jsx("option",{value:C,children:r},C))]}),e.jsx(b,{message:f.producto})]}):e.jsx("h2",{className:"text-red-500",children:"No hay productos disponibles para esta categoria"}),e.jsxs("div",{children:[e.jsx(j,{children:"Lista de trabajadores "}),e.jsxs(w,{onChange:L,className:"w-1/2",name:"tipoempleado",children:[e.jsx("option",{children:"Asignar a:"}),t.map(r=>e.jsxs("option",{value:r.id,children:[r.nombreCompleto," ",r.cargo]},r.id))]}),e.jsx(b,{message:f.empleado_id})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Cantidad asignada"}),e.jsx(W,{type:"number",onChange:r=>u("cantidad",r.target.value),min:1,max:s?s.cantidad-g:null}),e.jsx(b,{message:f.cantidad})]}),p=="Operador Externo"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(j,{children:"Costo Externo"}),e.jsx(N,{name:"tipocosto",id:"externo_normal",onChange:r=>u("tipocosto",r.target.id)})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Sin Costo "}),e.jsx(N,{name:"tipocosto",id:"sincosto",onChange:r=>u("tipocosto",r.target.id)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(j,{children:"Costo Normal"}),e.jsx(N,{name:"tipocosto",id:"operador_normal",onChange:r=>u("tipocosto",r.target.id)})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Costo Extra"}),e.jsx(N,{name:"tipocosto",id:"hora_extra",onChange:r=>u("tipocosto",r.target.id)})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Sin Costo "}),e.jsx(N,{name:"tipocosto",id:"sincosto",onChange:r=>u("tipocosto",r.target.id)})]})]}),e.jsx(b,{message:f.order_id}),e.jsx(b,{message:f.fecha_asignacion}),e.jsx(b,{message:f.tipocosto}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(V,{disabled:k,children:[" ",k?"Enviando...":"Enviar"]}),e.jsx(G,{show:F,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Asignar"})})]})]}),v&&e.jsx("p",{className:"text-green-500",children:v}),e.jsx(Y,{}),e.jsxs("section",{className:"m-4",children:[e.jsx("h2",{className:"text-gray-700 dark:text-gray-300 text-center uppercase",children:"Trabajos Asignados"}),e.jsx(ee,{asignacion:l,deleteAsignacion:o})]})]})},te=({orden:t})=>{const[s,x]=n.useState([]),c=i=>{y(route("asignacion.listar",i)).then(l=>x(l.data))};n.useEffect(()=>{c(t.id)},[t.id]);let a=s==null?void 0:s.reduce((i,l)=>i+(l.cantidad||0),0);return e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg  flex justify-between items-center gap-3",children:e.jsxs("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:["Asignados: ",e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-bold",children:[a,"/",t.cantidad]})]})})},ae=({pedido:t})=>{const{cliente:s,factura:x,fechaEntrega:c,envioDomicilio:a,estado:i}=t;return e.jsx(D,{sx:{borderLeft:"2px",borderRadius:"1rem"},children:e.jsx(P,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Información del Cliente"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Número Factura:"})," ","Fac-",x]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Cliente:"})," ",s.identification_number," -"," ",s.full_name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Entrega:"})," ",c||"Fecha no establecida"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Estado:"})," ",i]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Envío Domicilio:"})," ",a?"Envío Solicitado":"No solicitado"]})]})})})};function re(){const[t,s]=n.useState([]),[x,c]=n.useState(!0),[a,i]=n.useState(null);n.useEffect(()=>{let h=!0;return(async()=>{try{c(!0);const o=await y.get(route("categorias"));h&&(s(o.data.categorias),c(!1))}catch(o){h&&(i(o.message),c(!1))}})(),()=>{h=!1}},[]);const l=n.useMemo(()=>t,[t]);return{categorias:l,inforCategoria:h=>{const g=l.find(o=>o.id===h);return g?g.nameCategory:"Categoría no encontrada"}}}const Ee=({auth:t,empleados:s,pedido:x})=>{const{categorias:c,inforCategoria:a}=re(),{ordenes:i}=x.data[0],[l,m]=n.useState(!1),[h,g]=n.useState();return e.jsxs($,{user:t.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:["Asignación de Pedidos"," ",e.jsx(B,{className:"text-indigo-400 hover:text-indigo-600",href:"/asignacion",children:"/ Lista Pedidos"})]}),children:[e.jsx(M,{title:"Asignar Pedidos"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4",children:[e.jsx("div",{className:"grid-cols-subgrid col-span-1 row-span-4",children:e.jsx(ae,{pedido:x.data[0]})}),e.jsx("div",{className:"col-span-3 grid grid-cols-1 gap-6",children:e.jsx(D,{sx:{borderRadius:"1rem"},children:e.jsx(P,{children:e.jsx("form",{className:"space-y-6",children:i.map(o=>e.jsx("div",{className:`border p-4 rounded-lg transition-all duration-300 ${o.estado==="completado"?"border-green-500 bg-green-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-center",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:"/placeholder.svg",alt:"Producto",width:64,height:64,className:"rounded-md",style:{aspectRatio:"64/64",objectFit:"cover"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:o.producto}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Descripción:"," ",o.descripcion]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Talla: ",o.talla]})]})]}),e.jsxs("div",{className:"text-right space-y-3",children:[e.jsxs("p",{className:"text-gray-800 font-medium",children:["Categoría:",a(o.categoriaId)]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Cantidad: ",o.cantidad]}),e.jsxs("p",{className:`text-sm font-medium ${o.estado==="creado"?"text-yellow-500":o.estado==="procesando"?"text-blue-500":o.estado==="completado"?"text-green-500":"text-red-500"}`,children:["Estado: ",o.estado]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(q,{onClick:()=>{g(o),m(!0)},children:"Asignar Pedido"}),e.jsx(te,{orden:o})]})]})]})},o.id))})})})})]}),e.jsxs(H,{maxWidth:"lg",open:l,onClose:()=>m(!1),children:[e.jsx(J,{children:"Registrar Asignacion"}),e.jsxs(K,{children:[e.jsx("h1",{className:"text-gray-500",children:"Asignacion y costos de elaboracion"}),e.jsx(se,{empleados:s,orden:h})]}),e.jsx(Q,{children:e.jsx(U,{onClick:()=>m(!1),children:"Cancelar"})})]})]})};export{Ee as default};
